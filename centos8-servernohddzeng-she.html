<!DOCTYPE html>
<html lang="ja">
<head>
          <title>momori blog - CentOS8 ServerのHDD増設</title>
        <meta charset="utf-8" />
        <meta name="generator" content="Pelican" />
        <link href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="momori blog Full Atom Feed" />
        <link href="/feeds/server.atom.xml" type="application/atom+xml" rel="alternate" title="momori blog Categories Atom Feed" />

        <link rel="stylesheet" href="/theme/css/rdark.css" />
	<link rel="stylesheet" type="text/css" href="/theme/css/main.css" />
        <link href="/" type="application/atom+xml" rel="alternate" title="momori blog ATOM Feed" /><!--[if IE]><script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	
<!-- Using MathJax, with the delimiters $ -->
<!-- Conflict with pygments for the .mo and .mi -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
  "HTML-CSS": {
  styles: {
  ".MathJax .mo, .MathJax .mi": {color: "black ! important"}}
  },
  tex2jax: {inlineMath: [['$','$'], ['\\\\(','\\\\)']],processEscapes: true}
  });
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
</head>




    <meta name="tags" content="CentOS8" />
    <meta name="tags" content="Server" />
    <meta name="tags" content="linux" />
    <meta name="tags" content="HDD" />

</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">momori blog</a></h1>
        </header><!-- /#banner -->
        <nav id="menu"><ul>
            <li class="active"><a href="/category/server.html">Server</a></li>
            <li><a href="/category/test.html">test</a></li>
        </ul></nav><!-- /#menu -->
<section id="content" class="body">
  <header>
    <h2 class="entry-title">
      <a href="/centos8-servernohddzeng-she.html" rel="bookmark"
         title="Permalink to CentOS8 ServerのHDD増設">CentOS8 ServerのHDD増設</a></h2>
 
  </header>
  <footer class="post-info">
    <time class="published" datetime="2022-05-18T00:00:00+09:00">
      水 18 5月 2022
    </time>
    <address class="vcard author">
      By           <a class="url fn" href="/author/momori.html">momori</a>
    </address>
    <div class="category">
        Category: <a href="/category/server.html">Server</a>
    </div>
    <div class="tags">
        Tags:
            <a href="/tag/centos8.html">CentOS8</a>
            <a href="/tag/server.html">Server</a>
            <a href="/tag/linux.html">linux</a>
            <a href="/tag/hdd.html">HDD</a>
    </div>
  </footer><!-- /.post-info -->
  <div class="entry-content">
    <p>Kubernetesクラスタを作ってみることにしました．</p>
<p>詳細は別の機会に記事にすることとして，まずは物理的なサーバが１台のときのK8sクラスタを作ります！</p>
<p>その前準備として今回はCentOSのサーバをはじめに作ります．</p>
<p>以下の順で作業を進めます．</p>
<ol>
<li>CenOS8のインストール</li>
<li>RAID5でHDDを増設</li>
</ol>
<h2>1. CentOS8のインストール</h2>
<p>これに関しては備忘録に残しても仕方ないので，省略です．</p>
<h2>2. RAID5でHDDを増設</h2>
<p>dockerなどのコンテナを用いる一般的なサーバでは，コンテナ保存用のストレージとシステム用のストレージをは別体で分けておくことが望ましいようです．このあたりの詳しい内容は知らないので，また別の日にでも調べてみようと思います．</p>
<p>また，コンテナ用ストレージではRAID６を採用することが多いですが（コンテナ用だからってわけではないですが），今回はSATAポートが３つしか空いていないのでRAID5で構築することとします．RAID5でもRAID化する手順は同じなので勉強がてら５で構築しようというわけです．</p>
<p>さて，今回用意したHDDは中になにが入っているかよくわかんないものなので，フォーマット等の作業をしていきます．</p>
<ol>
<li>パーティションの削除</li>
<li>新しくパーティションを作成してext4でフォーマット</li>
<li>RAID5化</li>
</ol>
<h3>2-1 パーティションの削除</h3>
<p>まずはfdiskコマンドの-lオプションで何も指定せず，どんなものが繋がれているかみてみます．</p>
<div class="highlight"><pre><span></span><code><span class="o">[</span><span class="n">root@localhost ~</span><span class="o">]</span><span class="err">#</span><span class="w"> </span><span class="n">fdisk</span><span class="w"> </span><span class="o">-</span><span class="n">l</span><span class="w"></span>
</code></pre></div>

<p>今のサーバ環境はネットに接続されてないので，スクショが取れませんm(__)m</p>
<p>/dev/sdb, /dev/sdc, /dev/sddのなにかしらが出ていると思います．また，そのなかで１〜４パーティションに別れていたりしたので，とりあえずパーティションを全消去します．/dev/sdaはシステム用だから消しちゃダメ</p>
<p>わたしの環境の場合b〜cの３つあるので，まずは/dev/sdbのHDDから消します．</p>
<div class="highlight"><pre><span></span><code><span class="o">[</span><span class="n">root@localhost ~</span><span class="o">]</span><span class="err">#</span><span class="w"> </span><span class="n">fdisk</span><span class="w"> </span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">sdb</span><span class="w"></span>
</code></pre></div>

<p>これでfdiskのコマンドプロンプトで/dev/sdbをみれます．</p>
<p>対話モードになるので p で状態を表示します．</p>
<div class="highlight"><pre><span></span><code><span class="nv">Command</span> <span class="ss">(</span><span class="nv">m</span> <span class="k">for</span> <span class="nv">help</span><span class="ss">)</span>: <span class="nv">p</span>
</code></pre></div>

<p>すると，/dev/sdbのパーティション情報が確認できるはずです．</p>
<p>対話モードに戻っているので，次は d でパーティションを消去します．</p>
<div class="highlight"><pre><span></span><code><span class="nv">Command</span> <span class="ss">(</span><span class="nv">m</span> <span class="k">for</span> <span class="nv">help</span><span class="ss">)</span>: <span class="nv">d</span>
</code></pre></div>

<p>すると以下の対話モードになるはずなので，１−４のどれかを選択します．</p>
<div class="highlight"><pre><span></span><code>Partition number (1-4, default 4): 1
</code></pre></div>

<p>そしたら，パーティション１が削除されました．</p>
<div class="highlight"><pre><span></span><code>Partition 1 has been deleted
</code></pre></div>

<p>この作業を残りのパーティションで行います．</p>
<p>最後にすべてのパーティションが削除できたら，w　で保存します．</p>
<div class="highlight"><pre><span></span><code><span class="nv">Command</span> <span class="ss">(</span><span class="nv">m</span> <span class="k">for</span> <span class="nv">help</span><span class="ss">)</span>: <span class="nv">w</span>
</code></pre></div>

<p>これで/dev/sdbのパーティションの削除はおわりました．</p>
<p>c,dも同様の作業をしてパーティションを消去します．</p>
<h3>2-2 新しくパーティションを作成してext4でフォーマット</h3>
<p>もう一度fdiskコマンドを使います．</p>
<div class="highlight"><pre><span></span><code><span class="o">[</span><span class="n">root@localhost ~</span><span class="o">]</span><span class="err">#</span><span class="w"> </span><span class="n">fdisk</span><span class="w"> </span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">sdb</span><span class="w"></span>
</code></pre></div>

<p>次に n で新しいパーティションを作成します．</p>
<div class="highlight"><pre><span></span><code><span class="nv">Command</span> <span class="ss">(</span><span class="nv">m</span> <span class="k">for</span> <span class="nv">help</span><span class="ss">)</span>: <span class="nv">n</span>
</code></pre></div>

<p>パーティションタイプはPrimay　それ以外はdefaultで</p>
<div class="highlight"><pre><span></span><code>Select (default p): p
Partition number (1-4, default 1):
First sector (2048-488397167, default 2048):
Last sector, +sectors or +size{K,M,G,T,P} (2048-488397167, default 488397167):
</code></pre></div>

<p>もしsignature消去したい？ってきかれたら　Y</p>
<div class="highlight"><pre><span></span><code><span class="n">Do</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">want</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">remove</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">signature</span><span class="vm">?</span><span class="w"> </span><span class="o">[</span><span class="n">Y</span><span class="o">]</span><span class="n">es</span><span class="o">/[</span><span class="n">N</span><span class="o">]</span><span class="nl">o</span><span class="p">:</span><span class="w"> </span><span class="n">Y</span><span class="w"></span>
</code></pre></div>

<p>これでパーティションができました．最後に w で保存します．</p>
<div class="highlight"><pre><span></span><code><span class="nv">Command</span> <span class="ss">(</span><span class="nv">m</span> <span class="k">for</span> <span class="nv">help</span><span class="ss">)</span>: <span class="nv">w</span>
</code></pre></div>

<p>次にmkfs.ext4というコマンドで，sdb1をext4にフォーマットをします．少し時間がかかります．</p>
<div class="highlight"><pre><span></span><code><span class="o">[</span><span class="n">root@localhost ~</span><span class="o">]</span><span class="err">#</span><span class="w"> </span><span class="n">mkfs</span><span class="p">.</span><span class="n">ext4</span><span class="w"> </span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">sdb1</span><span class="w"></span>
</code></pre></div>

<p>これでフォーマットも完了です！</p>
<p>この作業をc,dにも行います．</p>
<h3>2-3 RAID5化</h3>
<p>RAID化はすごく簡単です．以下の様にコマンドを打つだけです．RAID1とかにしたいときはlevelを1へするだけ</p>
<div class="highlight"><pre><span></span><code><span class="o">[</span><span class="n">root@localhost ~</span><span class="o">]</span><span class="err">#</span><span class="w"> </span><span class="n">mdadm</span><span class="w"> </span><span class="c1">--create /dev/md1 --level=5 --raid-devices=3 /dev/sdb1 /dev/sdc1 /dev/sdd1</span>
</code></pre></div>

<p>続いて，RAID化したしたものをファイルシステムにフォーマットします．</p>
<div class="highlight"><pre><span></span><code><span class="o">[</span><span class="n">root@localhost ~</span><span class="o">]</span><span class="err">#</span><span class="w"> </span><span class="n">mkfs</span><span class="p">.</span><span class="n">ext4</span><span class="w"> </span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">md1</span><span class="w"></span>
</code></pre></div>

<p>最後にマウントしてあげれば完成です．わたしはdocker用に使う予定なので/var/lib/dockerにマウントします．</p>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="err">@</span><span class="n">localhost</span><span class="w"> </span><span class="o">~</span><span class="p">]</span><span class="c1"># mount /dev/md1 /var/lib/dockrer</span><span class="w"></span>
</code></pre></div>

<p>これでとりあえず環境の構築はできました！</p>
  </div><!-- /.entry-content -->
</section>
        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="https://getpelican.com/">Pelican</a>,
                which takes great advantage of <a href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->
        </footer><!-- /#contentinfo -->
</body>
</html>